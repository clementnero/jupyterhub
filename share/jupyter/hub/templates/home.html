{% extends "page.html" %}

{% block title %}
PwC Datalab | Control
{% endblock %}

{% block main %}

<div class="container">
  <div class="row">
    <div class="text-center">
      {% if user.running %}
      <a id="stop" class="btn btn-lg btn-danger">Stop My Server</a>
      {% endif %}
      <a id="start" class="btn btn-lg btn-success"
      {% if user.running %}
        href="{{ user.url }}"
      {% else %}
        href="{{base_url}}spawn"
      {% endif %}
      >
      {% if not user.running %}
      Start
      {% endif %}
        My Server
      </a>
      {% if user.admin %}
      <a id="admin" class="btn btn-lg btn-primary" href="{{base_url}}admin">Admin</a>
      {% endif %}
    </div>
  </div>
</div>
<div class="container">
    <div class="clock"></div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
require(["home"]);
require(["jquery","flipclock","jhapi"],function($,flip,jhapi){

    $(document).ready(function() {
        var clock;
        var base_url = window.jhdata.base_url;
        var user = window.jhdata.user;
        var api = new jhapi(base_url);

        api.get_user(user,{
          success: function (user) {
              var diff = user.total_time;
              var autoStart = false;
              if ($("#stop").is(':visible')) {
                  var currentDate = new Date(user.utc_now);
                  var pastDate  = new Date(user.last_spwaner_start);
                  diff += (currentDate.getTime() / 1000 - pastDate.getTime() / 1000)
                  autoStart = true
              }
              clock = $('.clock').FlipClock(diff, {
                clockFace: 'DailyCounter',
                autoStart: autoStart
              });
              $("#stop").on("spawner:stop", function(){
                clock.stop()
              })
          }
        })
    });
});
</script>
{% endblock %}